<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff41;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #00ff41;
            border-radius: 5px;
        }
        .success { color: #00ff41; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        button {
            background: #003300;
            color: #00ff41;
            border: 1px solid #00ff41;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        button:hover {
            background: #004400;
        }
        #log {
            height: 300px;
            overflow-y: auto;
            background: #001100;
            padding: 10px;
            border: 1px solid #00ff41;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ® å†’é™©æ¨¡æ‹Ÿå™¨ - åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ è„šæœ¬åŠ è½½æµ‹è¯•</h2>
        <div id="script-status">æ£€æŸ¥ä¸­...</div>
        <button onclick="testScriptLoading()">é‡æ–°æ£€æŸ¥è„šæœ¬</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ‘¤ è§’è‰²åˆ›å»ºæµ‹è¯•</h2>
        <button onclick="testCharacterCreation()">æµ‹è¯•è§’è‰²åˆ›å»º</button>
        <div id="character-status"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ² äº‹ä»¶ç³»ç»Ÿæµ‹è¯•</h2>
        <button onclick="testEventSystem()">æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ</button>
        <div id="event-status"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ’¾ æ•°æ®åº“æµ‹è¯•</h2>
        <button onclick="testDatabase()">æµ‹è¯•æ•°æ®åº“</button>
        <div id="database-status"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ® æ¸¸æˆå¼•æ“æµ‹è¯•</h2>
        <button onclick="testGameEngine()">æµ‹è¯•æ¸¸æˆå¼•æ“</button>
        <div id="engine-status"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“– UIç®¡ç†å™¨æµ‹è¯•</h2>
        <button onclick="testUIManager()">æµ‹è¯•UIç®¡ç†å™¨</button>
        <div id="ui-status"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”„ å®Œæ•´æµç¨‹æµ‹è¯•</h2>
        <button onclick="testFullWorkflow()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <div id="workflow-status"></div>
    </div>
    
    <div id="log"></div>

    <!-- åŠ è½½æ¸¸æˆè„šæœ¬ -->
    <script src="src/data/DatabaseManager.js"></script>
    <script src="src/game-engine/ProgressManager.js"></script>
    <script src="src/components/AchievementSystem.js"></script>
    <script src="src/events/GeneratedEventLoader.js"></script>
    <script src="src/events/AIEventGenerator.js"></script>
    <script src="src/components/Character.js"></script>
    <script src="src/events/EventSystem.js"></script>
    <script src="src/ui/UIManager.js"></script>
    <script src="src/game-engine/GameEngine.js"></script>

    <script>
        let testLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testLog.push(logEntry);
            
            const logDiv = document.getElementById('log');
            const p = document.createElement('p');
            p.textContent = logEntry;
            p.className = type;
            logDiv.appendChild(p);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(logEntry);
        }
        
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<span class="${type}">${message}</span>`;
        }
        
        // è„šæœ¬åŠ è½½æµ‹è¯•
        function testScriptLoading() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥è„šæœ¬åŠ è½½çŠ¶æ€...');
            
            const requiredClasses = [
                'Character',
                'GameEngine', 
                'UIManager',
                'EventSystem',
                'DatabaseManager',
                'GeneratedEventLoader',
                'AIEventGenerator',
                'AchievementSystem'
            ];
            
            let loadedCount = 0;
            let results = [];
            
            requiredClasses.forEach(className => {
                if (typeof window[className] !== 'undefined') {
                    results.push(`âœ… ${className} - å·²åŠ è½½`);
                    loadedCount++;
                } else {
                    results.push(`âŒ ${className} - æœªåŠ è½½`);
                }
            });
            
            const status = `${loadedCount}/${requiredClasses.length} ä¸ªç±»å·²åŠ è½½`;
            const type = loadedCount === requiredClasses.length ? 'success' : 'error';
            
            updateStatus('script-status', status + '<br>' + results.join('<br>'), type);
            log(`è„šæœ¬åŠ è½½æ£€æŸ¥å®Œæˆ: ${status}`, type);
        }
        
        // è§’è‰²åˆ›å»ºæµ‹è¯•
        function testCharacterCreation() {
            log('ğŸ‘¤ å¼€å§‹æµ‹è¯•è§’è‰²åˆ›å»º...');
            
            try {
                if (typeof Character === 'undefined') {
                    throw new Error('Characterç±»æœªå®šä¹‰');
                }
                
                // æµ‹è¯•ä¸åŒç±»å‹çš„è§’è‰²åå­—
                const testCases = [
                    { name: 'æé€é¥', profession: 'warrior' },
                    { name: 'å¼ æ— å¿Œ', profession: 'mage' },
                    { name: 'Arthas', profession: 'rogue' },
                    { name: 'å°æ˜', profession: 'priest' }
                ];
                
                let results = [];
                
                testCases.forEach(testCase => {
                    try {
                        const character = new Character(testCase.name, testCase.profession);
                        results.push(`âœ… ${testCase.name} (${character.getProfessionName()}) - ${character.getStorylineName()}`);
                        log(`è§’è‰²åˆ›å»ºæˆåŠŸ: ${testCase.name} - ${character.storyline}`);
                    } catch (error) {
                        results.push(`âŒ ${testCase.name} - ${error.message}`);
                        log(`è§’è‰²åˆ›å»ºå¤±è´¥: ${testCase.name} - ${error.message}`, 'error');
                    }
                });
                
                updateStatus('character-status', results.join('<br>'), 'success');
                log('è§’è‰²åˆ›å»ºæµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                updateStatus('character-status', `âŒ ${error.message}`, 'error');
                log(`è§’è‰²åˆ›å»ºæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // äº‹ä»¶ç³»ç»Ÿæµ‹è¯•
        function testEventSystem() {
            log('ğŸ² å¼€å§‹æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ...');
            
            try {
                if (typeof EventSystem === 'undefined') {
                    throw new Error('EventSystemç±»æœªå®šä¹‰');
                }
                
                const eventSystem = new EventSystem();
                const character = new Character('æµ‹è¯•è§’è‰²', 'warrior');
                
                // æµ‹è¯•è·å–éšæœºäº‹ä»¶
                const event = eventSystem.getRandomEvent(character.storyline);
                
                if (event) {
                    updateStatus('event-status', `âœ… æˆåŠŸè·å–äº‹ä»¶: ${event.title}`, 'success');
                    log(`äº‹ä»¶ç³»ç»Ÿæµ‹è¯•æˆåŠŸ: ${event.title}`, 'success');
                } else {
                    updateStatus('event-status', 'âš ï¸ æœªè·å–åˆ°äº‹ä»¶ï¼Œä½†ç³»ç»Ÿæ­£å¸¸', 'warning');
                    log('äº‹ä»¶ç³»ç»Ÿæ­£å¸¸ï¼Œä½†æœªè·å–åˆ°äº‹ä»¶', 'warning');
                }
                
            } catch (error) {
                updateStatus('event-status', `âŒ ${error.message}`, 'error');
                log(`äº‹ä»¶ç³»ç»Ÿæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ•°æ®åº“æµ‹è¯•
        async function testDatabase() {
            log('ğŸ’¾ å¼€å§‹æµ‹è¯•æ•°æ®åº“...');
            
            try {
                if (typeof DatabaseManager === 'undefined') {
                    throw new Error('DatabaseManageræœªå®šä¹‰');
                }
                
                // ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const stats = await window.DatabaseManager.getStatistics();
                
                updateStatus('database-status', 
                    `âœ… æ•°æ®åº“ç±»å‹: ${stats.storageType}<br>` +
                    `ğŸ“Š äº‹ä»¶æ•°é‡: ${stats.eventCount}<br>` +
                    `ğŸ’¾ å­˜å‚¨å¤§å°: ${stats.storageSize || 'N/A'}`, 'success');
                
                log(`æ•°æ®åº“æµ‹è¯•æˆåŠŸ: ${stats.storageType}, ${stats.eventCount} ä¸ªäº‹ä»¶`, 'success');
                
            } catch (error) {
                updateStatus('database-status', `âŒ ${error.message}`, 'error');
                log(`æ•°æ®åº“æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ¸¸æˆå¼•æ“æµ‹è¯•
        function testGameEngine() {
            log('ğŸ® å¼€å§‹æµ‹è¯•æ¸¸æˆå¼•æ“...');
            
            try {
                if (typeof GameEngine === 'undefined') {
                    throw new Error('GameEngineç±»æœªå®šä¹‰');
                }
                
                const engine = new GameEngine();
                
                updateStatus('engine-status', 'âœ… æ¸¸æˆå¼•æ“åˆ›å»ºæˆåŠŸ', 'success');
                log('æ¸¸æˆå¼•æ“æµ‹è¯•æˆåŠŸ', 'success');
                
            } catch (error) {
                updateStatus('engine-status', `âŒ ${error.message}`, 'error');
                log(`æ¸¸æˆå¼•æ“æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // UIç®¡ç†å™¨æµ‹è¯•
        function testUIManager() {
            log('ğŸ“– å¼€å§‹æµ‹è¯•UIç®¡ç†å™¨...');
            
            try {
                if (typeof UIManager === 'undefined') {
                    throw new Error('UIManagerç±»æœªå®šä¹‰');
                }
                
                const uiManager = new UIManager();
                
                // æµ‹è¯•å¯¼å‡ºåŠŸèƒ½
                const character = new Character('æµ‹è¯•è§’è‰²', 'warrior');
                const story = uiManager.exportStoryAsNovel(character);
                
                if (story && story.length > 0) {
                    updateStatus('ui-status', 'âœ… UIç®¡ç†å™¨å’Œå¯¼å‡ºåŠŸèƒ½æ­£å¸¸', 'success');
                    log('UIç®¡ç†å™¨æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    updateStatus('ui-status', 'âš ï¸ UIç®¡ç†å™¨åˆ›å»ºæˆåŠŸï¼Œä½†å¯¼å‡ºåŠŸèƒ½å¼‚å¸¸', 'warning');
                    log('UIç®¡ç†å™¨éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸', 'warning');
                }
                
            } catch (error) {
                updateStatus('ui-status', `âŒ ${error.message}`, 'error');
                log(`UIç®¡ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // å®Œæ•´æµç¨‹æµ‹è¯•
        async function testFullWorkflow() {
            log('ğŸ”„ å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯•...');
            
            try {
                // 1. åˆ›å»ºè§’è‰²
                const character = new Character('æµ‹è¯•å†’é™©è€…', 'warrior');
                log(`âœ… æ­¥éª¤1: è§’è‰²åˆ›å»ºæˆåŠŸ - ${character.name}`);
                
                // 2. åˆå§‹åŒ–æ¸¸æˆå¼•æ“
                const engine = new GameEngine();
                log('âœ… æ­¥éª¤2: æ¸¸æˆå¼•æ“åˆå§‹åŒ–æˆåŠŸ');
                
                // 3. æµ‹è¯•UIç®¡ç†å™¨
                const uiManager = new UIManager();
                await uiManager.addLogEntry('test', 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ—¥å¿—æ¡ç›®');
                log('âœ… æ­¥éª¤3: UIç®¡ç†å™¨æµ‹è¯•æˆåŠŸ');
                
                // 4. æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ
                const eventSystem = new EventSystem();
                const event = eventSystem.getRandomEvent(character.storyline);
                log(`âœ… æ­¥éª¤4: äº‹ä»¶ç³»ç»Ÿæµ‹è¯•æˆåŠŸ - ${event ? event.title : 'æ— äº‹ä»¶'}`);
                
                // 5. æµ‹è¯•æ•°æ®åº“
                const stats = await window.DatabaseManager.getStatistics();
                log(`âœ… æ­¥éª¤5: æ•°æ®åº“æµ‹è¯•æˆåŠŸ - ${stats.storageType}`);
                
                updateStatus('workflow-status', 'âœ… å®Œæ•´æµç¨‹æµ‹è¯•é€šè¿‡ï¼æ¸¸æˆå¯ä»¥æ­£å¸¸è¿è¡Œ', 'success');
                log('ğŸ‰ å®Œæ•´æµç¨‹æµ‹è¯•æˆåŠŸï¼', 'success');
                
            } catch (error) {
                updateStatus('workflow-status', `âŒ æµç¨‹æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(`å®Œæ•´æµç¨‹æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡ŒåŸºç¡€æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ğŸ® æ¸¸æˆæµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
                testScriptLoading();
            }, 1000);
        });
    </script>
</body>
</html>
