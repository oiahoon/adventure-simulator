<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆå¯åŠ¨æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #00ff41;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #00cc33;
        }
        .log-area {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            color: #ff4444;
        }
        .success {
            color: #44ff44;
        }
        .warning {
            color: #ffaa44;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª æ¸¸æˆå¯åŠ¨æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>1. ç³»ç»Ÿæ£€æŸ¥</h2>
            <button onclick="checkSystems()">æ£€æŸ¥æ‰€æœ‰ç³»ç»Ÿ</button>
            <button onclick="checkClasses()">æ£€æŸ¥ç±»å®šä¹‰</button>
            <button onclick="checkUI()">æ£€æŸ¥UIå…ƒç´ </button>
        </div>

        <div class="test-section">
            <h2>2. æ¸¸æˆå¼•æ“æµ‹è¯•</h2>
            <button onclick="initGameEngine()">åˆå§‹åŒ–æ¸¸æˆå¼•æ“</button>
            <button onclick="createTestCharacter()">åˆ›å»ºæµ‹è¯•è§’è‰²</button>
            <button onclick="startGameLoop()">å¯åŠ¨æ¸¸æˆå¾ªç¯</button>
            <button onclick="triggerTestEvent()">è§¦å‘æµ‹è¯•äº‹ä»¶</button>
        </div>

        <div class="test-section">
            <h2>3. äº‹ä»¶ç³»ç»Ÿæµ‹è¯•</h2>
            <button onclick="testEventSystem()">æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ</button>
            <button onclick="testUIManager()">æµ‹è¯•UIç®¡ç†å™¨</button>
            <button onclick="testEventDisplay()">æµ‹è¯•äº‹ä»¶æ˜¾ç¤º</button>
        </div>

        <div class="test-section">
            <h2>4. æ¸¸æˆå¾ªç¯æµ‹è¯•</h2>
            <button onclick="runGameSteps(5)">è¿è¡Œ5æ­¥</button>
            <button onclick="runGameSteps(10)">è¿è¡Œ10æ­¥</button>
            <button onclick="stopGame()">åœæ­¢æ¸¸æˆ</button>
        </div>

        <div class="test-section">
            <h2>æµ‹è¯•æ—¥å¿—</h2>
            <div id="test-log" class="log-area"></div>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <!-- å¼•å…¥æ¸¸æˆè„šæœ¬ -->
    <script src="src/data/DatabaseManager.js"></script>
    <script src="src/game-engine/ProgressManager.js"></script>
    <script src="src/components/AchievementSystem.js"></script>
    <script src="src/events/GeneratedEventLoader.js"></script>
    <script src="src/events/LLMEventGenerator.js"></script>
    <script src="src/events/AIEventGenerator.js"></script>
    <script src="src/events/EventSystem.js"></script>
    <script src="src/components/Character.js"></script>
    <script src="src/components/CharacterGrowth.js"></script>
    <script src="src/ui/CharacterGrowthUI.js"></script>
    <script src="src/game-engine/GameEngine.js"></script>
    <script src="src/ui/UIManager.js"></script>

    <script>
        let testGameEngine = null;
        let testCharacter = null;

        function log(message, type = 'info') {
            const logArea = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            
            logArea.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }

        function checkSystems() {
            log('ğŸ” å¼€å§‹ç³»ç»Ÿæ£€æŸ¥...');
            
            const requiredClasses = [
                'Character', 'GameEngine', 'EventSystem', 'UIManager',
                'CharacterGrowth', 'CharacterGrowthUI'
            ];
            
            const optionalClasses = [
                'AIEventGenerator', 'LLMEventGenerator', 'GeneratedEventLoader',
                'AchievementSystem', 'ProgressManager', 'DatabaseManager'
            ];
            
            let allGood = true;
            
            requiredClasses.forEach(className => {
                if (typeof window[className] !== 'undefined') {
                    log(`âœ… ${className} - å·²åŠ è½½`, 'success');
                } else {
                    log(`âŒ ${className} - æœªæ‰¾åˆ°`, 'error');
                    allGood = false;
                }
            });
            
            optionalClasses.forEach(className => {
                if (typeof window[className] !== 'undefined') {
                    log(`âœ… ${className} - å·²åŠ è½½ (å¯é€‰)`, 'success');
                } else {
                    log(`âš ï¸ ${className} - æœªæ‰¾åˆ° (å¯é€‰)`, 'warning');
                }
            });
            
            if (allGood) {
                log('ğŸ‰ æ‰€æœ‰å¿…éœ€ç³»ç»Ÿæ£€æŸ¥é€šè¿‡ï¼', 'success');
            } else {
                log('âŒ ç³»ç»Ÿæ£€æŸ¥å¤±è´¥ï¼Œç¼ºå°‘å¿…éœ€ç»„ä»¶', 'error');
            }
        }

        function checkClasses() {
            log('ğŸ” æ£€æŸ¥ç±»æ„é€ å‡½æ•°...');
            
            try {
                // æµ‹è¯•Characterç±»
                const testChar = new Character('æµ‹è¯•', 'warrior');
                log('âœ… Characterç±»æ„é€ æ­£å¸¸', 'success');
                
                // æµ‹è¯•CharacterGrowthç±»
                const testGrowth = new CharacterGrowth();
                log('âœ… CharacterGrowthç±»æ„é€ æ­£å¸¸', 'success');
                
                // æµ‹è¯•EventSystemç±»
                const testEvents = new EventSystem();
                log('âœ… EventSystemç±»æ„é€ æ­£å¸¸', 'success');
                
            } catch (error) {
                log(`âŒ ç±»æ„é€ å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function checkUI() {
            log('ğŸ” æ£€æŸ¥UIå…ƒç´ ...');
            
            // åˆ›å»ºæ¨¡æ‹Ÿçš„UIå…ƒç´ 
            if (!document.getElementById('log-content')) {
                const logDiv = document.createElement('div');
                logDiv.id = 'log-content';
                logDiv.style.display = 'none';
                document.body.appendChild(logDiv);
                log('âœ… åˆ›å»ºäº†æ¨¡æ‹Ÿæ—¥å¿—å®¹å™¨', 'success');
            }
            
            log('âœ… UIå…ƒç´ æ£€æŸ¥å®Œæˆ', 'success');
        }

        function initGameEngine() {
            log('ğŸ® åˆå§‹åŒ–æ¸¸æˆå¼•æ“...');
            
            try {
                testGameEngine = new GameEngine();
                log('âœ… æ¸¸æˆå¼•æ“åˆå§‹åŒ–æˆåŠŸ', 'success');
                window.gameEngine = testGameEngine; // è®¾ç½®å…¨å±€å¼•ç”¨
            } catch (error) {
                log(`âŒ æ¸¸æˆå¼•æ“åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function createTestCharacter() {
            log('ğŸ‘¤ åˆ›å»ºæµ‹è¯•è§’è‰²...');
            
            try {
                testCharacter = new Character('æµ‹è¯•å‹‡å£«', 'warrior');
                log('âœ… æµ‹è¯•è§’è‰²åˆ›å»ºæˆåŠŸ', 'success');
                
                if (testGameEngine) {
                    // åˆ›å»ºæ¸¸æˆçŠ¶æ€
                    testGameEngine.gameState = {
                        character: testCharacter,
                        gameTime: 0,
                        eventHistory: [],
                        addEventToHistory: function(event) {
                            this.eventHistory.push(event);
                        }
                    };
                    log('âœ… æ¸¸æˆçŠ¶æ€è®¾ç½®å®Œæˆ', 'success');
                }
            } catch (error) {
                log(`âŒ è§’è‰²åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function startGameLoop() {
            log('ğŸ”„ å¯åŠ¨æ¸¸æˆå¾ªç¯...');
            
            if (!testGameEngine) {
                log('âŒ è¯·å…ˆåˆå§‹åŒ–æ¸¸æˆå¼•æ“', 'error');
                return;
            }
            
            if (!testGameEngine.gameState) {
                log('âŒ è¯·å…ˆåˆ›å»ºæµ‹è¯•è§’è‰²', 'error');
                return;
            }
            
            try {
                testGameEngine.startGame();
                log('âœ… æ¸¸æˆå¾ªç¯å¯åŠ¨æˆåŠŸ', 'success');
            } catch (error) {
                log(`âŒ æ¸¸æˆå¾ªç¯å¯åŠ¨å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function triggerTestEvent() {
            log('ğŸ“… è§¦å‘æµ‹è¯•äº‹ä»¶...');
            
            if (!testGameEngine || !testGameEngine.gameState) {
                log('âŒ æ¸¸æˆæœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                testGameEngine.eventSystem.triggerRandomEvent(testGameEngine.gameState);
                log('âœ… æµ‹è¯•äº‹ä»¶è§¦å‘æˆåŠŸ', 'success');
            } catch (error) {
                log(`âŒ äº‹ä»¶è§¦å‘å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testEventSystem() {
            log('ğŸ“… æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ...');
            
            try {
                const eventSystem = new EventSystem();
                log('âœ… äº‹ä»¶ç³»ç»Ÿåˆ›å»ºæˆåŠŸ', 'success');
                
                // æµ‹è¯•äº‹ä»¶æ¨¡æ¿
                if (eventSystem.eventTemplates && eventSystem.eventTemplates.length > 0) {
                    log(`âœ… äº‹ä»¶æ¨¡æ¿åŠ è½½æˆåŠŸ: ${eventSystem.eventTemplates.length} ä¸ª`, 'success');
                } else {
                    log('âš ï¸ äº‹ä»¶æ¨¡æ¿ä¸ºç©º', 'warning');
                }
                
            } catch (error) {
                log(`âŒ äº‹ä»¶ç³»ç»Ÿæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testUIManager() {
            log('ğŸ¨ æµ‹è¯•UIç®¡ç†å™¨...');
            
            try {
                const uiManager = new UIManager();
                log('âœ… UIç®¡ç†å™¨åˆ›å»ºæˆåŠŸ', 'success');
                
                // æµ‹è¯•æ·»åŠ æ—¥å¿—æ¡ç›®
                uiManager.addLogEntry('test', 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¶ˆæ¯');
                log('âœ… æ—¥å¿—æ¡ç›®æ·»åŠ æµ‹è¯•æˆåŠŸ', 'success');
                
            } catch (error) {
                log(`âŒ UIç®¡ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testEventDisplay() {
            log('ğŸ“º æµ‹è¯•äº‹ä»¶æ˜¾ç¤º...');
            
            if (!testGameEngine || !testGameEngine.gameState) {
                log('âŒ æ¸¸æˆæœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const testEvent = {
                    title: 'æµ‹è¯•äº‹ä»¶',
                    description: 'è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•çš„äº‹ä»¶æè¿°ã€‚',
                    effects: {
                        attributes: { strength: 1 }
                    }
                };
                
                testGameEngine.eventSystem.displayEvent(testEvent, testGameEngine.gameState);
                log('âœ… äº‹ä»¶æ˜¾ç¤ºæµ‹è¯•æˆåŠŸ', 'success');
                
            } catch (error) {
                log(`âŒ äº‹ä»¶æ˜¾ç¤ºæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function runGameSteps(steps) {
            log(`ğŸƒ è¿è¡Œ ${steps} ä¸ªæ¸¸æˆæ­¥éª¤...`);
            
            if (!testGameEngine || !testGameEngine.gameState) {
                log('âŒ æ¸¸æˆæœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            let completedSteps = 0;
            const runStep = () => {
                if (completedSteps < steps) {
                    try {
                        testGameEngine.gameStep();
                        completedSteps++;
                        log(`âœ… æ­¥éª¤ ${completedSteps}/${steps} å®Œæˆ`);
                        
                        // ç»§ç»­ä¸‹ä¸€æ­¥
                        setTimeout(runStep, 500);
                    } catch (error) {
                        log(`âŒ æ­¥éª¤ ${completedSteps + 1} å¤±è´¥: ${error.message}`, 'error');
                    }
                } else {
                    log(`ğŸ‰ æ‰€æœ‰ ${steps} ä¸ªæ­¥éª¤å®Œæˆï¼`, 'success');
                }
            };
            
            runStep();
        }

        function stopGame() {
            log('ğŸ›‘ åœæ­¢æ¸¸æˆ...');
            
            if (testGameEngine) {
                testGameEngine.isRunning = false;
                if (testGameEngine.gameLoop) {
                    clearInterval(testGameEngine.gameLoop);
                    testGameEngine.gameLoop = null;
                }
                log('âœ… æ¸¸æˆå·²åœæ­¢', 'success');
            } else {
                log('âš ï¸ æ²¡æœ‰è¿è¡Œä¸­çš„æ¸¸æˆ', 'warning');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç³»ç»Ÿ
        window.addEventListener('load', function() {
            log('ğŸš€ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(checkSystems, 1000);
        });
    </script>
</body>
</html>
